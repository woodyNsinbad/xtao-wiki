# 项目使用及计费规则

## 1. 项目管理

当某个任务需要多人协作完成，比如某个课题组要完成一项较为复杂的研究，这时可以创建一个项目，然后邀请相关的人员加入。

项目创建者即为项目管理员项目。项目管理员可以邀请其他用户加入项目，用户同意后即可成为项目成员，非项目成员无法看到此项目信息。项目成员命令行投递任务时需要加上项目的标签（`qsub` 中 --project 选项），此时费用从项目中扣除。如果不指定项目标签，则视为个人的任务，从个人账户中扣除。项目管理员可以删除成员。可以查看项目中成员的计算资源使用及相关的费用。也可以查看具体的每笔账单（包括计算和存储）。创建项目时会自动以项目的标签创建一个目录，之后会按这个项目申请的配额计算费用。当项目欠费时，会在后台禁用此项目的标签，无法再投递此项目任务。管理员充值后如果不欠费，会重新启用此项目。具体操作如下：

### 1.1 创建项目

点击poros界面中的【项目】菜单![创建项目.png](/pic/server_usage/创建项目.png)
![项目概览.png](/pic/server_usage/项目概览.png)

### 1.2 成员管理
![成员管理.png](/pic/server_usage/成员管理.png)
### 1.3 成员消费
![成员账户.png](/pic/server_usage/成员账户.png)
### 1.4 项目服务
在项目中创建的服务都归属于此项目。
![项目服务.png](/pic/server_usage/项目服务.png)
### 1.5 项目任务
列出项目相关的任务
![项目任务.png](/pic/server_usage/项目任务.png)
### 1.6 处理项目邀请
在poros界面中的【项目】菜单的“消息”标签页中会有所有的邀请消息。用户可以自行决定同意/拒绝加入项目。同意后，在“项目”的标签页中就可以看到相应的项目。
![处理项目邀请.png](/pic/server_usage/处理项目邀请.png)

## 2. 项目任务的执行

通过命令行投递任务时需要指定项目的标签（见上节）。sge client可以通过qsub提交任务时通过指定`--project [my_project]`来为任务指定使用的project，例如: 

```bash
qsub --project my_project /mnt/vo1/test/test.sh
```

bioflow则需要在job的json配置文件中指定`project: my_project`来为该pipeline的job指定project。

> 对于投递任务的输出需要自行在脚本或者作业配置文件中指定到项目的路径，这时输出的文件/目录才能被项目内成员看到。同时也可以把这部分存储费用计入项目中。如果输出到个人目录里，占用的仍然是自己的空间。
{.is-warning}


## 3. 计费规则

费用按扣费类型分为个人任务和项目任务。个人任务所消耗的计算资源费用都会从个人账户中扣除。当任务按项目任务执行时则从项目费用中扣除。在个人中心里面可以看到个人的计算和存储费用账单以及账户余额。当个人账单欠费超过允许的上限时（默认是-10000。管理员可以通过poros界面中设置poros服务的MAX_OWE_FEE环境变量来改变默认值。比如设置成-100000，就会允许用户欠费10万），会将用户所有的调度域权限移除，无法再投递新任务。充值后会再重新加入到原来的调度域中。  

费用由两部分组成：计算费用和存储费用。其中存储费用为用户申请配额的空间的费用（按使用时长和申请的配额大小），所以在申请存储配额时需要先预估需要大小，建议不要申请的特别大。当后续有需要时，再在poros界面的个人中心或者项目中扩展存储的配额。